<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<!-- <head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>Startmin - Bootstrap Admin Theme</title>
<link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}">
Bootstrap Core CSS
<link href="..../static/css/bootstrap.min.css"
	th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
MetisMenu CSS
<link href="../static/css/metisMenu.min.css"
	th:href="@{/css/metisMenu.min.css}" rel="stylesheet">
Timeline CSS
<link href="../static/css/timeline.css" th:href="@{/css/timeline.css}"
	rel="stylesheet">
Custom CSS
<link href="../static/css/startmin.css" th:href="@{/css/startmin.css}"
	rel="stylesheet">
Morris Charts CSS
<link href="../static/css/morris.css" th:href="@{/css/morris.css}"
	rel="stylesheet">
Custom Fonts
<link href="../static/css/font-awesome.min.css" rel="stylesheet"
	th:href="@{/css/font-awesome.min.css}" type="text/css">
<script type="text/javascript" src="../static/js/lib/jquery.min.js" th:src="@{/js/lib/jquery.min.js}" ></script> -->
<head th:include="pages/head">
<script src="../static/datatable/js/datatables.min.js" th:src="@{/datatable/js/datatables.min.js}" type="text/javascript"></script>
<script src="/bootstrap3/js/bootstrap.js" th:src="@{/bootstrap3/js/bootstrap.js}" type="text/javascript"></script>
<!-- <script type="text/javascript" src="/js/config/user.js" th:src="@{/js/config/user.js}"></script> -->
<link rel="stylesheet" type="text/css" th:href="@{/css/config/user.css}" href="/css/user.css" />	


<!-- <script src="https://www.gstatic.com/firebasejs/7.17.2/firebase-app.js"></script>

If you enabled Analytics in your project, add the Firebase SDK for Analytics
<script src="https://www.gstatic.com/firebasejs/7.17.2/firebase-analytics.js"></script>

Add Firebase products that you want to use
<script src="https://www.gstatic.com/firebasejs/7.17.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.17.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.17.2/firebase-messaging.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyAL7vtnUhevluYqluEzOs74rFJV8XNVPyM",
    authDomain: "namnv-pns.firebaseapp.com",
    databaseURL: "https://namnv-pns.firebaseio.com",
    projectId: "namnv-pns",
    storageBucket: "namnv-pns.appspot.com",
    messagingSenderId: "338777072446",
    appId: "1:338777072446:web:5fcae33507f36afa35c26f",
    measurementId: "G-0WHB3CFSJM"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
  
//Retrieve Firebase Messaging object.
  const messaging = firebase.messaging();
  
  // [START set_public_vapid_key]
  // Add the public key generated from the console here.
  messaging.usePublicVapidKey('BK3PzFI1RxxGMi2QszqPcZQVP6sLqwwq7-lhBXxrLSr_XLPVabeBFtSGfxB40sybZC5-xE-0uiIC08HUd-so2Fk');
  // [END set_public_vapid_key]
  
  // Get Instance ID token. Initially this makes a network call, once retrieved
// subsequent calls to getToken will return from cache.
messaging.getToken().then((currentToken) => {
  if (currentToken) {
    sendTokenToServer(currentToken);
    updateUIForPushEnabled(currentToken);
  } else {
    // Show permission request.
    console.log('No Instance ID token available. Request permission to generate one.');
    // Show permission UI.
    updateUIForPushPermissionRequired();
    setTokenSentToServer(false);
  }
}).catch((err) => {
  console.log('An error occurred while retrieving token. ', err);
  showToken('Error retrieving Instance ID token. ', err);
  setTokenSentToServer(false);
});
</script> -->
</head>
<body>

	<div id="wrapper">

		<div th:replace="pages/menu"></div>

		<div id="page-wrapper">
			<div class="container-fluid">
				<div class="row">
					<div class="col-lg-12">
						<h1 class="page-header">Cấu hình tài khoản</h1>
					</div>
					<!-- /.col-lg-12 -->
				</div>
				<!-- /.row -->
				<div class="row">
					<div class="col-lg-12">
						<form th:action="@{/config/notif/sendMessage}" method="post">
								<input type="submit" value="Gửi tin nhắn" name="btnDel" id="btnSendMessage" />				
						</form>
					</div>
				</div>
				<div class="row">
					<div class="col-lg-3">
						<!-- <input type="button" value="Delete" name="btnDel" id="btnDelUser" />
						<input type="button" value="Add" name="btnAdd" id="btnAddUser" /> -->
					</div>
				</div>
				<!-- /.row -->
				<div class="row">
				<div id="token"></div>
    <div id="msg"></div>
    <div id="notis"></div>
    <div id="err"></div>
    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-messaging.js"></script>
    <script>
        MsgElem = document.getElementById("msg");
        TokenElem = document.getElementById("token");
        NotisElem = document.getElementById("notis");
        ErrElem = document.getElementById("err");
        // Initialize Firebase
        // TODO: Replace with your project's customized code snippet
          var firebaseConfig = {
			apiKey: "AIzaSyAL7vtnUhevluYqluEzOs74rFJV8XNVPyM",
			authDomain: "namnv-pns.firebaseapp.com",
			databaseURL: "https://namnv-pns.firebaseio.com",
			projectId: "namnv-pns",
			storageBucket: "namnv-pns.appspot.com",
			messagingSenderId: "338777072446",
			appId: "1:338777072446:web:5fcae33507f36afa35c26f",
			measurementId: "G-0WHB3CFSJM"
		  };
        firebase.initializeApp(firebaseConfig);

        const messaging = firebase.messaging();
        messaging
            .requestPermission()
            .then(function () {
                MsgElem.innerHTML = "Notification permission granted." 
                console.log("Notification permission granted.");
                
                // get the token in the form of promise
                return messaging.getToken()
            })
            .then(function(token) {
                TokenElem.innerHTML = "token is : " + token
            })
            .catch(function (err) {
                ErrElem.innerHTML =  ErrElem.innerHTML + "; " + err
                console.log("Unable to get permission to notify.", err);
            });

        let enableForegroundNotification = true;
        messaging.onMessage(function(payload) {
            console.log("Message received. ", payload);
            NotisElem.innerHTML = NotisElem.innerHTML + JSON.stringify(payload);

            if(enableForegroundNotification) {
                const {title, ...options} = JSON.parse(payload.data.notification);
                navigator.serviceWorker.getRegistrations().then(registration => {
                    registration[0].showNotification(title, options);
                });
            }
        });
    </script>

					<!-- /.col-lg-8 -->

					<!-- /.col-lg-4 -->
				</div>
				<!-- /.row -->
			</div>
			<!-- /.container-fluid -->
		</div>
		<!-- /#page-wrapper -->

	</div>
	<!-- /#wrapper -->
</body>
</html>
